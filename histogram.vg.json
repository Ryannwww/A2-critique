{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Age-specific Cancer Incidence Rate by Age Group (Persons All cancers combined 2024)",
  "width": 860,
  "height": 420,
  "data": { "url": "cancer_agegroups.csv", "format": {"type": "csv"} },

  "transform": [
    { "calculate": "toNumber(datum['Year'])", "as": "Year_num" },

    { "calculate": "trim(datum['Sex'] || datum[' Sex'] || datum['\\uFEFFSex'])", "as": "Sex_clean" },
    { "calculate": "trim(datum['Cancer group/site'] || datum[' Cancer group/site'] || datum['\\uFEFFCancer group/site'])", "as": "Cancer_clean" },
    { "calculate": "trim(datum['Age group (years)'])", "as": "Age_group" },

    { "calculate": "replace(datum['Count']+'', /,/g, '')", "as": "Count_str" },
    { "calculate": "toNumber(datum.Count_str)", "as": "Count_num" },

    {
      "calculate": "replace((datum['Age-specific rate\\n(cases per 100,000)']||'')+'', /[^0-9.]+/g, '')",
      "as": "Rate_str"
    },
    { "calculate": "toNumber(datum.Rate_str)", "as": "Rate" },

    {
      "filter": "datum.Year_num == 2024 && test(/Persons/i, datum.Sex_clean) && test(/All cancers combined/i, datum.Cancer_clean)"
    },
    { "filter": "isFinite(datum.Rate)" }
  ],

  "mark": "bar",

  "encoding": {
    "x": {
      "field": "Age_group",
      "type": "ordinal",
      "title": "Age group (years)",
      "sort": "ascending"
    },
    "y": {
      "field": "Rate",
      "type": "quantitative",
      "title": "Age-specific rate (per 100,000)"
    },
    "tooltip": [
      { "field": "Cancer_clean", "title": "Cancer group" },
      { "field": "Sex_clean", "title": "Sex" },
      { "field": "Age_group", "title": "Age group" },
      { "field": "Rate", "type": "quantitative", "title": "Rate (per 100,000)" },
      { "field": "Count_num", "type": "quantitative", "title": "Count" }
    ]
  },

  "config": {
    "axis": { "labelFontSize": 11, "titleFontSize": 12 },
    "title": { "fontSize": 16 },
    "view": { "stroke": null }
  }
}
