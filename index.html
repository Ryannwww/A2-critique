<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>AU Cancer Mortality Choropleth + Top 10 Bar + Bubble + Histogram</title>
  <link href="https://fonts.googleapis.com/css2?family=Alegreya:ital,wght@0,400..900;1,400..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 24px; }
    .wrap { max-width: 1100px; margin-inline: auto; }
    .viz { margin: 20px 0 24px; }
    .viz + h2 { margin-top: 72px; }
    h1 {
      font-family: "Alegreya", serif;
      font-size: 42px;
      font-weight: 700;
      color: #1a1a1a;
      text-align: center;
      margin-top: 10px;
      margin-bottom: 12px;
    }
    p.intro {
      font-size: 18px;
      line-height: 1.7;
      color: #444;
      text-align: center;
      max-width: 900px;
      margin-inline: auto;
      margin-bottom: 40px;
    }
    h2 { margin: 0 0 8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Cancer across Australia</h1>
    <p class="intro">Cancer can be detrimental, you can explore facts about cancer down below about types and prevalent cancer types in Australia.</p>

    <h2>Cancer Mortality (ASR per 100,000) Australia by State</h2>
    <div id="visMap" class="viz"></div>
    <p>Use the slider to compare ASR across years (2010 to 2020). Darker shades indicate higher rates.</p>
    <p>ASR is age-standardised to the 2024 Australian population, per 100,000.</p>

    <h2>Top 15 Cancer Types by Incidence</h2>
    <div id="visBar" class="viz"></div>
    <p>Use the slider to increase the total number of cases, to see the difference in cases between cancer types</p>
    <p>Prostate cancer has the most confirmed cases in the year 2021 followed by breast cancer</p>

    <h2>Age-specific Cancer Incidence Rate by Age Group (Persons All cancers combined 2024)</h2>
    <div id="visHist" class="viz"></div>
    <p>Bars show the incidence rate per 100,000 for each age group.</p>

    <h2>Incidence vs Mortality by Cancer Type (Persons, All ages, 2025)</h2>
    <div id="visBubble" class="viz"></div>
    <p>For the top 15 cancers displayed in the bar chart above, this bubble chart illustrates the mortality rate per 100000 against incident rate per 100000. Each bubble is a cancer type. Position shows age-specific incidence vs mortality rate; bubble size shows incident cases.</p>

    <h2>Annual New Cancer Cases (Line)</h2>
    <div id="visLine" class="viz"></div>
    <p>Shows the number of new cancer cases each year.</p>
    <h2>Change in Cancer Cases by Type (Stacked Area)</h2>
    <div id="visArea" class="viz"></div>
    <p>Shows how the number of cases has changed over time by cancer type.</p>

  </div>

  <script>
    /*  Choropleth */
    const mapSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Cancer Mortality in Australia by State"},
      "width": 860,
      "height": 520,
      "projection": {"type": "equalEarth"},
      "params": [
        {"name": "yearSelected","value": 2020,"bind": {"input": "range","min": 2010,"max": 2020,"step": 1,"name": "Year: "}}
      ],
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Ryannwww/3179-homework-9/main/cancer_mortality.json",
            "format": {"type": "topojson", "feature": "CED_2021_AUST_GDA94"}
          },
          "mark": {"type": "geoshape", "fill": "#f3f6fa", "stroke": "#b8c4d7"}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Ryannwww/3179-homework-9/main/cancer_mortality.json",
            "format": {"type": "topojson", "feature": "CED_2021_AUST_GDA94"}
          },
          "transform": [
            {
              "lookup": "properties.STE_NAME21",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/Ryannwww/3179-homework-9/main/cancer_mortality_clean.csv",
                  "format": {"type": "csv"}
                },
                "key": "state",
                "fields": [
                  "year","sex","deaths count",
                  "Age-standardised rate\n2024 Australian population \n(per 100,000"
                ]
              }
            },
            { "calculate": "toNumber(datum.year)", "as": "year_num" },
            { "calculate": "trim(datum.sex)", "as": "sex_clean" },
            { "calculate": "toNumber(datum['deaths count'])", "as": "deaths" },
            {
              "calculate": "datum['Age-standardised rate\\n2024 Australian population \\n(per 100,000']",
              "as": "asr_persons"
            },
            { "filter": "datum.year_num == yearSelected" }
          ],
          "mark": { "type": "geoshape", "stroke": "white", "strokeWidth": 1, "strokeOpacity": 1 },
          "encoding": {
            "color": {
              "field": "asr_persons",
              "type": "quantitative",
              "title": "Age-standardised rate 2024 Australian population (per 100,000)",
              "scale": {
                "type": "threshold",
                "domain": [180, 190, 200, 210, 220, 230, 260],
                "range": ["#fdbe85", "#fd8d3c", "#e6550d", "#a63603"]
              },
              "legend": { "title": "Age-standardised rate(per 100,000)", "titleFontSize": 10, "labelFontSize": 8 }
            },
            "tooltip": [
              {"field": "properties.STE_NAME21", "type": "nominal", "title": "State/Territory"},
              {"field": "year_num", "type": "quantitative", "title": "Year"},
              {"field": "asr_persons", "type": "quantitative", "title": "Age-standardised rate", "format": ".1f"},
              {"field": "deaths", "type": "quantitative", "title": "Deaths"}
            ]
          }
        }
      ]
    };

    /*Top 15 Bar  */
    const barSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Top 15 Cancer Types by Incidence (Totals)"},
      "width": 860,
      "height": 440,
      "data": {
        "url": "https://raw.githubusercontent.com/Ryannwww/homework-10/main/cancer_types.csv",
        "format": {"type": "csv"}
      },
      "params": [
        {
          "name": "MinCases","value": 0,
          "bind": {"input": "range","min": 0,"max": 30000,"step": 1000,"name": "Minimum cases: "}
        }
      ],
      "transform": [
        { "calculate": "trim(datum['Row Labels'])", "as": "label" },
        { "calculate": "replace(datum['Grand Total'], /,/g, '')", "as": "cases_str" },
        { "calculate": "toNumber(datum.cases_str)", "as": "cases_num" },
        { "filter": "datum.label !== 'Grand Total' && isFinite(datum.cases_num) && datum.label !== ''" },
        { "filter": "datum.cases_num >= MinCases" },
        { "window": [{"op": "rank", "as": "rk"}], "sort": [{"field": "cases_num", "order": "descending"}] },
        { "filter": "datum.rk <= 15" }
      ],
      "mark": "bar",
      "encoding": {
        "y": { "field": "label", "type": "nominal", "title": "Cancer type", "sort": "-x" },
        "x": { "field": "cases_num", "type": "quantitative", "title": "Total cases", "scale": {"domainMin": 0}, "axis":{"format": ",", "labelFontSize": 11, "titleFontSize": 12} },
        "tooltip": [
          {"field": "label", "title": "Cancer type"},
          {"field": "cases_num", "type": "quantitative", "title": "Cases", "format": ","}
        ]
      },
      "config": { "axis": {"labelFontSize": 11, "titleFontSize": 12}, "title": {"fontSize": 16}, "numberFormat": "," }
    };

    /*Histogram  */
    const histSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Age-specific Cancer Incidence Rate by Age Group (Persons All cancers combined 2024)",
      "width": 860, "height": 420,
      "data": { "url": "cancer_agegroups.csv", "format": {"type": "csv"} },
      "transform": [
        { "calculate": "toNumber(datum['Year'])", "as": "Year_num" },
        { "calculate": "trim(datum['Sex'] || datum[' Sex'] || datum['\\uFEFFSex'])", "as": "Sex_clean" },
        { "calculate": "trim(datum['Cancer group/site'] || datum[' Cancer group/site'] || datum['\\uFEFFCancer group/site'])", "as": "Cancer_clean" },
        { "calculate": "trim(datum['Age group (years)'])", "as": "Age_group" },
        { "calculate": "replace((datum['Count']||'')+'', /,/g, '')", "as": "Count_str" },
        { "calculate": "toNumber(datum.Count_str)", "as": "Count_num" },
        { "calculate": "replace((datum['Age-specific rate\\n(cases per 100,000)']||'')+'', /[^0-9.]+/g, '')", "as": "Rate_str" },
        { "calculate": "toNumber(datum.Rate_str)", "as": "Rate" },
        { "filter": "datum.Year_num == 2024 && test(/Persons/i, datum.Sex_clean) && test(/All cancers combined/i, datum.Cancer_clean)" },
        { "filter": "isFinite(datum.Rate)" }
      ],
      "mark": "bar",
      "encoding": {
        "x": { "field": "Age_group", "type": "ordinal", "title": "Age group (years)", "sort": "ascending" },
        "y": { "field": "Rate", "type": "quantitative", "title": "Age-specific rate (per 100,000)" },
        "tooltip": [
          { "field": "Age_group", "title": "Age group" },
          { "field": "Rate", "type": "quantitative", "title": "Rate (per 100,000)" },
          { "field": "Count_num", "type": "quantitative", "title": "Count" }
        ]
      },
      "config": { "axis": { "labelFontSize": 11, "titleFontSize": 12 }, "title": { "fontSize": 16 }, "view": { "stroke": null } }
    };

    /*Line chart  */
    const lineSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Number of New Cancer Cases in Australia (Line)","fontSize": 18,"anchor": "start","offset": 12},
      "width": 860, "height": 420,
      "data": { "url": "case_changing.csv", "format": { "type": "csv" } },
      "transform": [
        { "calculate": "trim((datum['Year']||datum['\\uFEFFYear']||datum[' Year']||'')+'')", "as": "Year_str" },
        { "calculate": "toNumber(datum.Year_str)", "as": "Year_num" },
        {
          "calculate": "replace((datum['Number of new cases']||datum['\\uFEFFNumber of new cases']||datum[' Number of new cases']||datum['Cases']||datum['Count']||'')+'', /[^0-9.\\-]+/g, '')",
          "as": "Cases_str"
        },
        { "calculate": "toNumber(datum.Cases_str)", "as": "Cases" },
        { "filter": "isFinite(datum.Year_num) && isFinite(datum.Cases)" }
      ],
      "mark": { "type": "line", "point": true, "strokeWidth": 3, "color": "#1f77b4" },
      "encoding": {
        "x": { "field": "Year_num", "type": "quantitative", "title": "Year", "axis": { "format": "d", "labelAngle": 0 } },
        "y": { "field": "Cases", "type": "quantitative", "title": "Number of New Cases", "axis": { "format": "," } },
        "tooltip": [
          { "field": "Year_num", "type": "quantitative", "title": "Year", "format": "d" },
          { "field": "Cases", "type": "quantitative", "title": "New Cases", "format": "," }
        ]
      },
      "config": { "view": { "stroke": null }, "axis": { "labelFontSize": 11, "titleFontSize": 12 } }
    };

    /* Stacked area chart */
    const areaSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Change in Cancer Cases by Type (Stacked Area)","fontSize": 18,"anchor": "start","offset": 12},
      "width": 860, "height": 420,
      "data": { "url": "count_change.csv", "format": { "type": "csv" } },
      "transform": [
        { "calculate": "trim((datum['Type']||datum['\\uFEFFType']||datum[' Type']||datum['Cancer type']||datum['Cancer Type']||datum['type']||'')+'')", "as": "Type_clean" },
        { "calculate": "toNumber(trim((datum['Year']||datum['\\uFEFFYear']||datum[' Year']||'')+''))", "as": "Year_num" },
        {
          "calculate": "replace((datum['Count']||datum['\\uFEFFCount']||datum[' Count']||datum['Counts']||datum['Number of new cases']||datum['Number of cases']||datum['Value']||'')+'', /[^0-9.\\-]+/g, '')",
          "as": "Count_str"
        },
        { "calculate": "toNumber(datum.Count_str)", "as": "Count_num" },
        { "filter": "datum.Type_clean !== '' && isFinite(datum.Year_num) && isFinite(datum.Count_num)" },
        { "aggregate": [{"op": "sum", "field": "Count_num", "as": "Count_sum"}], "groupby": ["Year_num", "Type_clean"] }
      ],
      "mark": { "type": "area", "opacity": 0.7, "line": true, "point": true },
      "encoding": {
        "x": { "field": "Year_num", "type": "quantitative", "title": "Year", "axis": { "format": "d", "labelAngle": 0 } },
        "y": { "field": "Count_sum", "type": "quantitative", "title": "Number of Cases", "axis": { "format": "," }, "stack": "zero" },
        "color": { "field": "Type_clean", "type": "nominal", "title": "Cancer type", "scale": { "scheme": "tableau10" }, "legend": { "columns": 1 } },
        "tooltip": [
          { "field": "Year_num", "type": "quantitative", "title": "Year", "format": "d" },
          { "field": "Type_clean", "type": "nominal", "title": "Type" },
          { "field": "Count_sum", "type": "quantitative", "title": "Cases", "format": "," }
        ]
      },
      "config": { "view": { "stroke": null }, "axis": { "labelFontSize": 11, "titleFontSize": 12 } }
    };

    /*  Bubble */
    const bubbleSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Incidence vs Mortality by Cancer Type (Persons, All ages, 2025)"},
      "width": 860, "height": 520,
      "data": { "url": "incident_to_mortality.csv" },
      "transform": [
        { "calculate": "toNumber(datum.Year)", "as": "Year_num" },
        { "filter": "datum.Year_num == 2025" },
        { "filter": "datum.Sex === 'Persons'" },
        { "filter": "datum.Age_group === 'All ages combined'" },
        {
          "calculate":
            "isValid(datum['Cancer_types']) ? trim(datum['Cancer_types']+'') : " +
            "isValid(datum['\\uFEFFCancer_types']) ? trim(datum['\\uFEFFCancer_types']+'') : " +
            "isValid(datum['Cancer types']) ? trim(datum['Cancer types']+'') : ''",
          "as": "Cancer"
        },
        { "calculate": "toNumber(replace(datum['Incident_count'], ',', ''))", "as": "incidents" },
        { "calculate": "toNumber(replace(datum['Mortality_counts'], ',', ''))", "as": "deaths" },
        { "calculate": "toNumber(datum['Age-specific incident rate\\n(cases per 100,000)'])", "as": "inc_rate" },
        { "calculate": "toNumber(datum['Age-specific mortality rate\\n(cases per 100,000)'])", "as": "mort_rate" },
        { "filter": "isValid(datum.inc_rate) && isValid(datum.mort_rate) && datum.Cancer !== ''" }
      ],
      "mark": { "type": "circle", "opacity": 0.8, "tooltip": true },
      "encoding": {
        "x": { "field": "inc_rate", "type": "quantitative", "title": "Age-specific incidence rate (per 100,000)", "scale": {"nice": true} },
        "y": { "field": "mort_rate", "type": "quantitative", "title": "Age-specific mortality rate (per 100,000)", "scale": {"nice": true} },
        "size": { "field": "incidents", "type": "quantitative", "title": "Incident cases", "legend": { "orient": "right" }, "scale": {"type": "threshold","domain": [500, 1000, 2000, 5000, 10000, 15000, 20000, 25000, 30000],"range": [10, 50, 150, 200, 300, 400, 450, 500, 550]} },
        "color": { "field": "Cancer", "type": "nominal", "title": "Cancer type" },
        "tooltip": [
          { "field": "Cancer", "type": "nominal", "title": "Cancer" },
          { "field": "incidents", "type": "quantitative", "title": "Incidents" },
          { "field": "deaths", "type": "quantitative", "title": "Deaths" },
          { "field": "inc_rate", "type": "quantitative", "title": "Incidence rate" },
          { "field": "mort_rate", "type": "quantitative", "title": "Mortality rate" }
        ]
      },
      "config": { "view": { "stroke": null }, "axis": { "grid": true } }
    };

    /* Embed all */
    vegaEmbed("#visMap", mapSpec).catch(console.error);
    vegaEmbed("#visBar", barSpec).catch(console.error);
    vegaEmbed("#visHist", histSpec).catch(console.error);
    vegaEmbed("#visBubble", bubbleSpec).catch(console.error);
    vegaEmbed("#visLine", lineSpec).catch(console.error);
    vegaEmbed("#visArea", areaSpec).catch(console.error);

  </script>
</body>
</html>
