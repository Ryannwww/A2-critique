{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {"text": "What Causes Cancer? Share of Attributable Cases", "fontSize": 18, "anchor": "start", "offset": 12},
  "width": 520,
  "height": 520,
  "data": {"url": "cancer_causes.csv", "format": {"type": "csv"}},

  "transform": [
    { "calculate": "trim((datum['Causes']||datum['\\uFEFFCauses']||datum[' Causes']||datum['Cause']||'')+'')", "as": "cause" },
    { "calculate": "replace((datum['Contribute']||datum['\\uFEFFContribute']||datum[' Contribute']||datum['Percent']||datum['Value']||'')+'', /[^0-9.]+/g, '')", "as": "val_str" },
    { "calculate": "toNumber(datum.val_str)", "as": "value" },
    { "filter": "datum.cause !== '' && isFinite(datum.value)" },
    { "joinaggregate": [{"op": "sum", "field": "value", "as": "total"}] },
    { "calculate": "round(datum.value / datum.total * 100)", "as": "pct" }
  ],

  "mark": {"type": "arc", "outerRadius": 250, "innerRadius": 100, "tooltip": true, "stroke": "white", "strokeWidth": 1.5},
  "encoding": {
    "theta": {"field": "value", "type": "quantitative", "stack": "normalize"},
    "color": {"field": "cause", "type": "nominal", "title": "Cause", "scale": {"scheme": "tableau10"}},
    "tooltip": [
      {"field": "cause", "title": "Cause"},
      {"field": "pct", "type": "quantitative", "title": "Share (%)", "format": ".0f"}
    ]
  },

  "config": {"view": {"stroke": null}}
}
